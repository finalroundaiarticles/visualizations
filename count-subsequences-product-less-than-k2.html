<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recursion Tree Animation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #FFFFFF;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 90%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            color: #000000;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .explanation {
            color: #000000;
            margin-bottom: 30px;
            text-align: center;
            max-width: 800px;
        }
        
        .animation-container {
            width: 100%;
            overflow: auto;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #FD9F78;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .node circle {
            fill: #FD9F78;
            stroke: #FF4800;
            stroke-width: 2px;
        }
        
        .node text {
            font-family: Arial, sans-serif;
            font-size: 12px;
            fill: #000000;
        }
        
        .node.highlighted circle {
            fill: #FF4800;
        }
        
        .link {
            fill: none;
            stroke: #000000;
            stroke-width: 2px;
        }
        
        .label {
            font-size: 10px;
            fill: #000000;
        }
        
        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            background-color: #FF4800;
            color: #FFFFFF;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #FD9F78;
        }
        
        button:disabled {
            background-color: #FD9F78;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .step-indicator {
            color: #000000;
            font-weight: bold;
            margin: 0 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Recursion Tree for Array [2, 3, 4] with K=6</h1>
        
        <div class="explanation">
            <p>This visualization shows a recursion tree for finding subsets of array [2, 3, 4] whose product equals K=6.</p>
            <p>Each node shows the current product and array index. Left branches include the element, right branches exclude it.</p>
        </div>
        
        <div class="animation-container">
            <svg id="tree-svg" width="900" height="500"></svg>
        </div>
        
        <div class="navigation">
            <button id="prev-btn" disabled>Previous Step</button>
            <span class="step-indicator" id="step-indicator">Step 1 of 8</span>
            <button id="next-btn">Next Step</button>
        </div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Create the tree structure
        const treeData = {
            name: "product=1, index=0",
            description: "Starting with product=1 at index 0",
            children: [
                {
                    name: "product=2, index=1",
                    description: "Include 2, product becomes 2",
                    edge_label: "Include 2",
                    children: [
                        {
                            name: "product=6, index=2",
                            description: "Include 3, product becomes 6",
                            edge_label: "Include 3",
                            children: [
                                {
                                    name: "product=24, index=3",
                                    description: "Include 4, product becomes 24 (>6, not a solution)",
                                    edge_label: "Include 4",
                                    result: "Reject (product > 6)"
                                },
                                {
                                    name: "product=6, index=3",
                                    description: "Exclude 4, product remains 6",
                                    edge_label: "Exclude 4",
                                    result: "Accept (product = 6)"
                                }
                            ]
                        },
                        {
                            name: "product=2, index=2",
                            description: "Exclude 3, product remains 2",
                            edge_label: "Exclude 3",
                            children: [
                                {
                                    name: "product=8, index=3",
                                    description: "Include 4, product becomes 8 (>6, not a solution)",
                                    edge_label: "Include 4",
                                    result: "Reject (product > 6)"
                                },
                                {
                                    name: "product=2, index=3",
                                    description: "Exclude 4, product remains 2",
                                    edge_label: "Exclude 4",
                                    result: "Reject (product < 6)"
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "product=1, index=1",
                    description: "Exclude 2, product remains 1",
                    edge_label: "Exclude 2",
                    children: [
                        {
                            name: "product=3, index=2",
                            description: "Include 3, product becomes 3",
                            edge_label: "Include 3",
                            children: [
                                {
                                    name: "product=12, index=3",
                                    description: "Include 4, product becomes 12 (>6, not a solution)",
                                    edge_label: "Include 4",
                                    result: "Reject (product > 6)"
                                },
                                {
                                    name: "product=3, index=3",
                                    description: "Exclude 4, product remains 3",
                                    edge_label: "Exclude 4",
                                    result: "Reject (product < 6)"
                                }
                            ]
                        },
                        {
                            name: "product=1, index=2",
                            description: "Exclude 3, product remains 1",
                            edge_label: "Exclude 3",
                            children: [
                                {
                                    name: "product=4, index=3",
                                    description: "Include 4, product becomes 4",
                                    edge_label: "Include 4",
                                    result: "Reject (product < 6)"
                                },
                                {
                                    name: "product=1, index=3",
                                    description: "Exclude 4, product remains 1",
                                    edge_label: "Exclude 4",
                                    result: "Reject (product < 6)"
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        // Animation sequence
        const animationSteps = [
            { nodes: [0], description: "Start with product=1 at index 0. We'll decide whether to include or exclude each element." },
            { nodes: [0, 1], description: "Left branch: Include element 2, product becomes 2." },
            { nodes: [0, 1, 3], description: "Left branch: Include element 3, product becomes 6." },
            { nodes: [0, 1, 3, 7, 8], description: "For product=6: Include 4 (product=24, too large) or exclude 4 (product=6, equals K). Found a solution!" },
            { nodes: [0, 1, 4], description: "Right branch: Exclude element 3, product remains 2." },
            { nodes: [0, 1, 4, 9, 10], description: "For product=2: Include 4 (product=8, too large) or exclude 4 (product=2, too small). No solution here." },
            { nodes: [0, 2], description: "Right branch from root: Exclude element 2, product remains 1." },
            { nodes: [0, 2, 5, 6, 11, 12, 13, 14], description: "Explore remaining branches. No other solutions found because products are either too small or too large." }
        ];

        let currentStep = 0;
        const totalSteps = animationSteps.length;

        // Flatten tree to assign unique IDs to nodes
        let nodeId = 0;
        function assignIds(node) {
            node.id = nodeId++;
            if (node.children) {
                node.children.forEach(assignIds);
            }
            return node;
        }
        assignIds(treeData);

        // Set up the D3 tree layout
        const width = 900;
        const height = 500;
        const margin = { top: 40, right: 90, bottom: 50, left: 90 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const svg = d3.select("#tree-svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Create a tree layout
        const treeLayout = d3.tree()
            .size([innerWidth, innerHeight]);

        // Convert the data to a hierarchy
        const root = d3.hierarchy(treeData);
        
        // Assign x and y positions to each node
        treeLayout(root);

        // Draw links
        const links = g.selectAll(".link")
            .data(root.links())
            .enter()
            .append("path")
            .attr("class", "link")
            .attr("d", d3.linkHorizontal()
                .x(d => d.y)
                .y(d => d.x))
            .style("opacity", 0);

        // Draw edge labels
        const edgeLabels = g.selectAll(".label")
            .data(root.links())
            .enter()
            .append("text")
            .attr("class", "label")
            .attr("x", d => (d.source.y + d.target.y) / 2)
            .attr("y", d => (d.source.x + d.target.x) / 2 - 5)
            .text(d => d.target.data.edge_label || "")
            .style("text-anchor", "middle")
            .style("opacity", 0);

        // Draw nodes
        const nodes = g.selectAll(".node")
            .data(root.descendants())
            .enter()
            .append("g")
            .attr("class", d => `node node-${d.data.id}`)
            .attr("transform", d => `translate(${d.y},${d.x})`)
            .style("opacity", 0);

        // Add circles to nodes
        nodes.append("circle")
            .attr("r", 20);

        // Add text to nodes
        nodes.append("text")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .text(d => d.data.name.split(',')[0])
            .append("tspan")
            .attr("x", 0)
            .attr("dy", "1.2em")
            .text(d => d.data.name.split(',')[1]);

        // Add result text for leaf nodes
        nodes.filter(d => d.data.result)
            .append("text")
            .attr("dy", "2.5em")
            .attr("text-anchor", "middle")
            .attr("font-weight", "bold")
            .text(d => d.data.result)
            .style("fill", d => d.data.result.includes("Accept") ? "#FF4800" : "#000000");

        // Function to update the animation
        function updateAnimation() {
            const step = animationSteps[currentStep];
            
            // Reset all nodes and links
            nodes.classed("highlighted", false)
                .style("opacity", 0.3);
            
            links.style("opacity", 0.3);
            edgeLabels.style("opacity", 0.3);
            
            // Highlight current nodes and their links
            step.nodes.forEach(nodeId => {
                d3.select(`.node-${nodeId}`)
                    .classed("highlighted", true)
                    .style("opacity", 1);
                
                // Find links connected to this node
                root.links().forEach((link, i) => {
                    if (link.source.data.id === nodeId || link.target.data.id === nodeId) {
                        links.nodes()[i].style.opacity = 1;
                        edgeLabels.nodes()[i].style.opacity = 1;
                    }
                });
            });
            
            // Update step indicator
            document.getElementById("step-indicator").textContent = `Step ${currentStep + 1} of ${totalSteps}`;
            
            // Update button states
            document.getElementById("prev-btn").disabled = currentStep === 0;
            document.getElementById("next-btn").disabled = currentStep === totalSteps - 1;
        }

        // Initialize the animation
        nodes.style("opacity", 0.3);
        links.style("opacity", 0.3);
        edgeLabels.style("opacity", 0.3);
        updateAnimation();

        // Add event listeners for navigation buttons
        document.getElementById("prev-btn").addEventListener("click", () => {
            if (currentStep > 0) {
                currentStep--;
                updateAnimation();
            }
        });

        document.getElementById("next-btn").addEventListener("click", () => {
            if (currentStep < totalSteps - 1) {
                currentStep++;
                updateAnimation();
            }
        });
    </script>
</body>
</html>